<Page x:Class="DNA.WpfApp.Pages.Patients.PatientsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Patients Management"
      Background="White">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="10"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title and Add Patient Button -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Corrected ampersand here -->
                <TextBlock Grid.Column="0" Text="Quáº£n lÃ½ bá»‡nh nhÃ¢n &amp; dá»‹ch vá»¥ xÃ©t nghiá»‡m ADN" FontSize="24" FontWeight="Bold" VerticalAlignment="Center"/>
                <Button Grid.Column="1" x:Name="btnAddPatient" Content="âž• ThÃªm bá»‡nh nhÃ¢n má»›i" Click="BtnAddPatient_Click"
                        Style="{StaticResource PrimaryButtonStyle}" Padding="15,8"/>
            </Grid>            <!-- Quick Actions Toolbar -->
            <StackPanel Grid.Row="2" x:Name="quickActionsPanel" Orientation="Horizontal" HorizontalAlignment="Left">
                <TextBlock Text="Thao tÃ¡c nhanh:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,10,0"/>
                <Button Content="ðŸ“Š Dashboard ADN" Style="{StaticResource SecondaryButtonStyle}" 
                        Click="BtnDNADashboard_Click" Margin="0,0,5,0" Padding="8,4"/>
                <Button Content="ðŸ§ª Quáº£n lÃ½ dá»‹ch vá»¥" Style="{StaticResource SecondaryButtonStyle}" 
                        Click="BtnManageServices_Click" Margin="0,0,5,0" Padding="8,4"/>
                <Button Content="ðŸ“ˆ BÃ¡o cÃ¡o tá»•ng há»£p" Style="{StaticResource SecondaryButtonStyle}" 
                        Click="BtnComprehensiveReport_Click" Margin="0,0,5,0" Padding="8,4"/>
                <Button Content="âš™ï¸ CÃ i Ä‘áº·t báº£ng giÃ¡" Style="{StaticResource SecondaryButtonStyle}" 
                        Click="BtnManagePricing_Click" Padding="8,4"/>
            </StackPanel>
        </Grid>
        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="10"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- First row of filters -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="300"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0" x:Name="txtSearch" Style="{StaticResource InputTextBoxStyle}"
                         Tag="TÃ¬m kiáº¿m theo tÃªn, email, sá»‘ Ä‘iá»‡n thoáº¡i..." TextChanged="TxtSearch_TextChanged"/>

                <ComboBox Grid.Column="2" x:Name="cmbGenderFilter" SelectionChanged="CmbGenderFilter_SelectionChanged">
                    <ComboBoxItem Content="Táº¥t cáº£ giá»›i tÃ­nh"/>
                    <ComboBoxItem Content="Nam"/>
                    <ComboBoxItem Content="Ná»¯"/>
                </ComboBox>

                <ComboBox Grid.Column="4" x:Name="cmbStatusFilter" SelectionChanged="CmbStatusFilter_SelectionChanged">
                    <ComboBoxItem Content="Táº¥t cáº£ tráº¡ng thÃ¡i"/>
                    <ComboBoxItem Content="Äang hoáº¡t Ä‘á»™ng"/>
                    <ComboBoxItem Content="KhÃ´ng hoáº¡t Ä‘á»™ng"/>
                </ComboBox>

                <ComboBox Grid.Column="6" x:Name="cmbDNATestStatusFilter" SelectionChanged="CmbDNATestStatusFilter_SelectionChanged">
                    <ComboBoxItem Content="Táº¥t cáº£ xÃ©t nghiá»‡m"/>
                    <ComboBoxItem Content="ChÆ°a xÃ©t nghiá»‡m"/>
                    <ComboBoxItem Content="Äang xÃ©t nghiá»‡m"/>
                    <ComboBoxItem Content="HoÃ n thÃ nh"/>
                    <ComboBoxItem Content="ÄÃ£ há»§y"/>
                </ComboBox>
            </Grid>

            <!-- Second row with action buttons -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button x:Name="btnExportReport" Content="ðŸ“Š Xuáº¥t bÃ¡o cÃ¡o" 
                        Click="BtnExportReport_Click" Style="{StaticResource SecondaryButtonStyle}" 
                        Margin="0,0,10,0" Padding="10,5"/>
                <Button Content="ðŸ”„ LÃ m má»›i" Click="BtnRefresh_Click" 
                        Style="{StaticResource SecondaryButtonStyle}" Padding="10,5"/>
            </StackPanel>
        </Grid>

        <Border Grid.Row="2" Style="{StaticResource CardStyle}">
            <Grid>
                <TextBlock x:Name="txtLoading" Text="Äang táº£i dá»¯ liá»‡u..."
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           FontSize="18" FontWeight="Bold" Visibility="Collapsed" Panel.ZIndex="1"/>

                <TextBlock x:Name="txtNoData" Text="KhÃ´ng cÃ³ dá»¯ liá»‡u bá»‡nh nhÃ¢n nÃ o."
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           FontSize="16" Foreground="Gray" Visibility="Collapsed" Panel.ZIndex="1"/>

                <DataGrid x:Name="dgPatients" AutoGenerateColumns="False" IsReadOnly="True"
                          SelectionMode="Single" GridLinesVisibility="Horizontal"
                          RowHeaderWidth="0" CanUserResizeRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding PatientId}" Width="50"/>
                        <DataGridTextColumn Header="Há» vÃ  tÃªn" Binding="{Binding FullName}" Width="150"/>
                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="150"/>
                        <DataGridTextColumn Header="Sá»‘ Ä‘iá»‡n thoáº¡i" Binding="{Binding Phone}" Width="110"/>
                        <DataGridTextColumn Header="NgÃ y sinh" Binding="{Binding DateOfBirth, StringFormat='dd/MM/yyyy'}" Width="90"/>
                        <DataGridTextColumn Header="Giá»›i tÃ­nh" Binding="{Binding Gender}" Width="70"/>
                        <DataGridTextColumn Header="Tráº¡ng thÃ¡i" Binding="{Binding Status}" Width="100"/>
                        <DataGridTextColumn Header="Tráº¡ng thÃ¡i ADN" Binding="{Binding DNATestStatus}" Width="120"/>
                        <DataGridTextColumn Header="Sá»‘ láº§n XN" Binding="{Binding TotalDNATests}" Width="80"/>
                        <DataGridTemplateColumn Header="Quáº£n lÃ½ bá»‡nh nhÃ¢n" Width="180">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="âœï¸" ToolTip="Sá»­a thÃ´ng tin" Style="{StaticResource SecondaryButtonStyle}"
                                                Click="BtnEditPatient_Click" Margin="2" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                        <Button Content="ðŸ—‘ï¸" ToolTip="XÃ³a bá»‡nh nhÃ¢n" Style="{StaticResource DangerButtonStyle}"
                                                Click="BtnDeletePatient_Click" Margin="2" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                        <Button Content="ðŸ“‹" ToolTip="Xem há»“ sÆ¡" Style="{StaticResource SecondaryButtonStyle}"
                                                Click="BtnViewPatientRecord_Click" Margin="2" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="Dá»‹ch vá»¥ xÃ©t nghiá»‡m ADN" Width="250">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="ðŸ§¬" ToolTip="Äáº·t xÃ©t nghiá»‡m ADN" Style="{StaticResource PrimaryButtonStyle}"
                                                Click="BtnBookDNATest_Click" Margin="1" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                        <Button Content="ðŸ“¦" ToolTip="YÃªu cáº§u kit xÃ©t nghiá»‡m" Style="{StaticResource SecondaryButtonStyle}"
                                                Click="BtnRequestSampleKit_Click" Margin="1" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                        <Button Content="ðŸ " ToolTip="Äáº·t lá»‹ch thu máº«u táº¡i nhÃ " Style="{StaticResource SecondaryButtonStyle}"
                                                Click="BtnScheduleHomeSample_Click" Margin="1" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                        <Button Content="ðŸ“Š" ToolTip="Theo dÃµi tiáº¿n Ä‘á»™" Style="{StaticResource SecondaryButtonStyle}"
                                                Click="BtnTrackTestProgress_Click" Margin="1" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                        <Button Content="ðŸ“‘" ToolTip="Xem káº¿t quáº£" Style="{StaticResource SuccessButtonStyle}"
                                                Click="BtnViewTestResults_Click" Margin="1" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                        <Button Content="ðŸ“" ToolTip="Lá»‹ch sá»­ xÃ©t nghiá»‡m" Style="{StaticResource SecondaryButtonStyle}"
                                                Click="BtnViewDNATestHistory_Click" Margin="1" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="ÄÃ¡nh giÃ¡" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <!-- Corrected ampersand here -->
                                        <Button Content="â­" ToolTip="Xem Ä‘Ã¡nh giÃ¡ &amp; pháº£n há»“i" Style="{StaticResource SecondaryButtonStyle}"
                                                Click="BtnPatientFeedback_Click" Margin="2" Width="28" Height="25"
                                                Tag="{Binding PatientId}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</Page>
